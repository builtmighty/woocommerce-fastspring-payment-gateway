var checkoutForm=jQuery("form.checkout");function setLoadingDone(){checkoutForm.removeClass("processing").unblock()}function setLoadingOn(){checkoutForm.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function dataCallbackFunction(e){console.log("dataCallbackFunction:",e)}function errorCallback(e,r){console.log("errorCallback: ",e,r)}function getAjaxURL(e){return woocommerce_fastspring_params.ajax_url.toString().replace("%%endpoint%%","wc_fastspring_"+e)}function fastspringBeforeRequestHandler(){setLoadingDone()}function fastspringPopupCloseHandler(e){clearTimeout(fastspringPopupTimeout),jQuery.ajax({type:"POST",url:woocommerce_params.ajax_url,data:{nonce:woocommerce_fastspring_params.nonce.create_actual_order,form_data:checkoutForm.serialize(),action:"wc_fs_create_actual_order",fastspring_order_id:e.reference},dataType:"json",success:function(r){try{if("success"===r.data.result){if(e&&e.reference)requestPaymentCompletionUrl(e||{},function(e,r){if(console.log("requestPaymentCompletionUrl",e,r),e)throw Error(e);window.location=r.redirect_url});else throw Error("No reference found in data on wc_fs_create_actual_order action")}else if("failure"===r.data.result)throw Error("Result failure");else throw Error("Invalid response")}catch(o){if(!0===r.data.reload){window.location.reload();return}!0===r.data.refresh&&jQuery(document.body).trigger("update_checkout"),r.data.messages?submitError(r.data.messages):submitError('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>"),console.error("Checkout Error:",r)}},error:function(e,r,o){submitError('<div class="woocommerce-error">'+o+"</div>")}})}function requestPaymentCompletionUrl(e,r){e.security=woocommerce_fastspring_params.nonce.receipt,jQuery.ajax({type:"POST",dataType:"json",data:JSON.stringify(e),url:getAjaxURL("get_receipt"),success:function(e){r(null,e)},error:function(e,o,t){r(e.responseText)}})}const FASTSPRING_POPUP_TIMEOUT=woocommerce_fastspring_params.popup_timeout||864e5;let fastspringPopupTimeout;function handleFastSpringPopupTimeout(){console.warn("FastSpring popup session has timed out."),alert("Your session has timed out. The page will be refreshed."),window.location.reload()}function launchFastSpring(e){console.log(e),fastspring.builder.secure(e.payload,e.key),fastspring.builder.checkout(),clearTimeout(fastspringPopupTimeout),fastspringPopupTimeout=setTimeout(handleFastSpringPopupTimeout,FASTSPRING_POPUP_TIMEOUT)}function unserialize(e){let r=new URLSearchParams(e),o={};for(let[t,a]of r)o[t]=a;return o}function setTempOrder(){jQuery.ajax({type:"POST",url:woocommerce_params.ajax_url,data:{nonce:woocommerce_fastspring_params.nonce.receipt,form_data:checkoutForm.serialize(),action:"wc_fs_create_temp_order"},dataType:"json",success:function(e){try{if("success"===e.data.result)e.data.temp_order_data.temp_order_nonce&&(woocommerce_fastspring_params.nonce.create_actual_order=e.data.temp_order_data.temp_order_nonce),launchFastSpring(e.data.session);else if("failure"===e.data.result)throw Error("Result failure");else if("error"===e.data.result)submitError(e.data.messages);else throw Error("Invalid response")}catch(r){if(!0===e.reload){window.location.reload();return}!0===e.refresh&&jQuery(document.body).trigger("update_checkout"),e.messages?submitError(e.messages):submitError('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}},error:function(e,r,o){submitError('<div class="woocommerce-error">'+o+"</div>")}})}function doSubmit(){setLoadingOn(),setTempOrder()}function submitError(e){if(setLoadingDone(),jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),Array.isArray(e)){var r='<ul class="woocommerce-error wc-fs-error-list">';e.forEach(function(e){r+="<li>"+e+"</li>"}),r+="</ul>",checkoutForm.prepend(r)}else checkoutForm.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>");checkoutForm.removeClass("processing"),checkoutForm.find(".input-text, select, input:checkbox").trigger("validate").blur(),jQuery("html, body").animate({scrollTop:jQuery("form.checkout").offset().top-100},1e3),jQuery(document.body).trigger("checkout_error")}function isFastSpringSelected(){return"payment_method_fastspring"===jQuery('.woocommerce-checkout input[name="payment_method"]:checked').attr("id")}checkoutForm.on("click","#place_order",function(e){if(isFastSpringSelected())return e.stopImmediatePropagation(),e.preventDefault(),doSubmit(),!1}),checkoutForm.on("checkout_place_order",function(){window.location=res.redirect_url});